<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Notes and Codes while Learning R</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="这里是明生学 R 的笔记。">
  <meta name="generator" content="bookdown 0.1 and GitBook 2.6.7">

  <meta property="og:title" content="Notes and Codes while Learning R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://bookdown.org/scottming/rns/" />
  
  <meta property="og:description" content="这里是明生学 R 的笔记。" />
  <meta name="github-repo" content="scottming/rns" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Notes and Codes while Learning R" />
  
  <meta name="twitter:description" content="这里是明生学 R 的笔记。" />
  

<meta name="author" content="Scott Ming">

<meta name="date" content="2016-07-30">


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="readr.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="r4ds.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Notes and Codes while Learning R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="part"><span><b>Base</b></span></li>
<li class="chapter" data-level="1" data-path="r-.html"><a href="r-.html"><i class="fa fa-check"></i><b>1</b> R 数据结构</a><ul>
<li class="chapter" data-level="1.1" data-path="r-.html"><a href="r-.html#section-1.1"><i class="fa fa-check"></i><b>1.1</b> 向量</a></li>
<li class="chapter" data-level="1.2" data-path="r-.html"><a href="r-.html#section-1.2"><i class="fa fa-check"></i><b>1.2</b> 矩阵</a></li>
<li class="chapter" data-level="1.3" data-path="r-.html"><a href="r-.html#section-1.3"><i class="fa fa-check"></i><b>1.3</b> 数据框</a></li>
<li class="chapter" data-level="1.4" data-path="r-.html"><a href="r-.html#section-1.4"><i class="fa fa-check"></i><b>1.4</b> 列表</a></li>
<li class="chapter" data-level="1.5" data-path="r-.html"><a href="r-.html#section-1.5"><i class="fa fa-check"></i><b>1.5</b> 特殊对象</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="readr.html"><a href="readr.html"><i class="fa fa-check"></i><b>2</b> 数据读取（readr）</a><ul>
<li class="chapter" data-level="2.1" data-path="readr.html"><a href="readr.html#-read.table"><i class="fa fa-check"></i><b>2.1</b> 读取 read.table</a></li>
<li class="chapter" data-level="2.2" data-path="readr.html"><a href="readr.html#-readr"><i class="fa fa-check"></i><b>2.2</b> 高阶包 readr</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="apply.html"><a href="apply.html"><i class="fa fa-check"></i><b>3</b> 向量化操作（apply）</a><ul>
<li class="chapter" data-level="3.1" data-path="apply.html"><a href="apply.html#-lapplysapply"><i class="fa fa-check"></i><b>3.1</b> 循环迭代之 lapply/sapply</a></li>
<li class="chapter" data-level="3.2" data-path="apply.html"><a href="apply.html#section-3.2"><i class="fa fa-check"></i><b>3.2</b> 分组运算</a></li>
<li class="chapter" data-level="3.3" data-path="apply.html"><a href="apply.html#section-3.3"><i class="fa fa-check"></i><b>3.3</b> 多参数运算</a></li>
</ul></li>
<li class="part"><span><b>Explore</b></span></li>
<li class="chapter" data-level="4" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>4</b> 数据预处理（dplyr）</a><ul>
<li class="chapter" data-level="4.1" data-path="dplyr.html"><a href="dplyr.html#section-4.1"><i class="fa fa-check"></i><b>4.1</b> 导入数据</a></li>
<li class="chapter" data-level="4.2" data-path="dplyr.html"><a href="dplyr.html#-filter"><i class="fa fa-check"></i><b>4.2</b> 数据筛选 filter，返回满足条件的观测值</a></li>
<li class="chapter" data-level="4.3" data-path="dplyr.html"><a href="dplyr.html#-select"><i class="fa fa-check"></i><b>4.3</b> 子集选取 select，只保留选择的变量</a></li>
<li class="chapter" data-level="4.4" data-path="dplyr.html"><a href="dplyr.html#-arrange"><i class="fa fa-check"></i><b>4.4</b> 数据排序 arrange</a></li>
<li class="chapter" data-level="4.5" data-path="dplyr.html"><a href="dplyr.html#-mutate"><i class="fa fa-check"></i><b>4.5</b> 数据扩展 mutate</a></li>
<li class="chapter" data-level="4.6" data-path="dplyr.html"><a href="dplyr.html#-summarise"><i class="fa fa-check"></i><b>4.6</b> 数据汇总 summarise</a></li>
<li class="chapter" data-level="4.7" data-path="dplyr.html"><a href="dplyr.html#-join"><i class="fa fa-check"></i><b>4.7</b> 数据连接 join</a></li>
<li class="chapter" data-level="4.8" data-path="dplyr.html"><a href="dplyr.html#-group_by"><i class="fa fa-check"></i><b>4.8</b> 分组汇总 group_by</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Notes and Codes while Learning R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="r-" class="section level1">
<h1><span class="header-section-number">1</span> R 数据结构</h1>
<div id="section-1.1" class="section level2">
<h2><span class="header-section-number">1.1</span> 向量</h2>
<p>R 里面的向量看起来像 Python 的 list，但又不是 list，更像是Python 里一维的数组。</p>
<p><strong>向量入门</strong></p>
<p>基础</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">4</span>)
vec[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>)]
<span class="co">#&gt; [1] 1 2 6</span>
<span class="kw">class</span>(vec)
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
vec[<span class="dv">1</span>:<span class="dv">2</span>] <span class="co"># 末尾包含</span>
<span class="co">#&gt; [1] 1 2</span></code></pre></div>
<p>Python 代码,除了用列表推导式之外还可以直接用 Numpy 实现</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> numpy <span class="im">as</span> np
a<span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">4</span>])
<span class="bu">print</span> a[[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>]]
<span class="bu">print</span> <span class="bu">type</span>(a)
<span class="co">#&gt; [1 2 6]</span>
<span class="co">#&gt; &lt;type &#39;numpy.ndarray&#39;&gt;</span></code></pre></div>
<p>创建向量 类 Python range</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">10</span>)
a
<span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span>
b &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">10</span>, <span class="dv">13</span>)
b
<span class="co">#&gt; [1] 10 11 12 13</span>
temp &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">0</span>)
temp *<span class="st"> </span>b
<span class="co">#&gt; [1] 10 22 48  0</span></code></pre></div>
<p>生成有规律的向量， 类 np.linspace</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vec &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dt">length.out =</span> <span class="dv">10</span>) <span class="co"># 还有个long参数也非常有用。</span>
vec
<span class="co">#&gt;  [1]   1  12  23  34  45  56  67  78  89 100</span>
vec[-<span class="dv">4</span>] <span class="co">#这点跟 Python 很不一样</span>
<span class="co">#&gt; [1]   1  12  23  45  56  67  78  89 100</span>

<span class="kw">seq</span>(<span class="dt">from=</span><span class="dv">2</span>, <span class="dt">to=</span><span class="dv">1000</span>, <span class="dt">length.out =</span> <span class="dv">10</span>)
<span class="co">#&gt;  [1]    2  113  224  335  446  556  667  778  889 1000</span>
<span class="kw">seq</span>(<span class="dt">from=</span><span class="dv">2</span>, <span class="dt">to=</span><span class="dv">1000</span>, <span class="dt">length=</span><span class="dv">10</span>)
<span class="co">#&gt;  [1]    2  113  224  335  446  556  667  778  889 1000</span>

group1 &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>:<span class="dv">3</span>, <span class="dt">times =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">9</span>))
group2 &lt;-<span class="st"> </span><span class="kw">factor</span>(group1) <span class="co"># 转换成因子</span>
group1
<span class="co">#&gt;  [1] 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3</span>
<span class="kw">class</span>(group1)
<span class="co">#&gt; [1] &quot;integer&quot;</span>
<span class="kw">class</span>(group2)
<span class="co">#&gt; [1] &quot;factor&quot;</span>
<span class="kw">length</span>(group1) <span class="co"># as Py len</span>
<span class="co">#&gt; [1] 27</span></code></pre></div>
<p>随机向量</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vec_random1 &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">5</span>) <span class="co"># 0-1</span>
vec_random1
<span class="co">#&gt; [1] 0.0808 0.8343 0.6008 0.1572 0.0074</span>
vec_random2 &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&#39;A&#39;</span>, <span class="st">&#39;B&#39;</span>), <span class="dt">size =</span> <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>) <span class="co"># 随机字符向量</span>
vec_random2
<span class="co">#&gt;  [1] &quot;A&quot; &quot;A&quot; &quot;A&quot; &quot;B&quot; &quot;B&quot; &quot;B&quot; &quot;A&quot; &quot;A&quot; &quot;A&quot; &quot;A&quot;</span>
vector1 &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="dv">10</span>)
vector1 <span class="co"># empty vector</span>
<span class="co">#&gt;  [1] 0 0 0 0 0 0 0 0 0 0</span></code></pre></div>
<p>逻辑判断</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">temp[<span class="dv">1</span>:<span class="dv">3</span>]
<span class="co">#&gt; [1] 1 2 4</span>
temp[<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>)]
<span class="co">#&gt; [1] 1 2</span>
temp[temp &gt;<span class="st"> </span><span class="dv">1</span>]
<span class="co">#&gt; [1] 2 4</span></code></pre></div>
</div>
<div id="section-1.2" class="section level2">
<h2><span class="header-section-number">1.2</span> 矩阵</h2>
<p>矩阵是二维的容器，可包含数值、逻辑、字符等数据</p>
<p>生成矩阵</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vector &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="dv">12</span>
<span class="kw">class</span>(vector)
<span class="co">#&gt; [1] &quot;integer&quot;</span>
my_matrix &lt;-<span class="st"> </span><span class="kw">matrix</span>(vector, <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">4</span>, <span class="dt">byrow =</span> <span class="ot">FALSE</span>)
<span class="kw">dim</span>(my_matrix)
<span class="co">#&gt; [1] 3 4</span>
vector
<span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11 12</span>
my_matrix
<span class="co">#&gt;      [,1] [,2] [,3] [,4]</span>
<span class="co">#&gt; [1,]    1    4    7   10</span>
<span class="co">#&gt; [2,]    2    5    8   11</span>
<span class="co">#&gt; [3,]    3    6    9   12</span>

vector1 &lt;-<span class="st"> </span>vector2 &lt;-<span class="st"> </span>vector3 &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">3</span>)
my_matrix &lt;-<span class="st"> </span><span class="kw">cbind</span>(vector1, vector2, vector3) <span class="co"># 一致的向量类型进行合并</span>
my_matrix
<span class="co">#&gt;      vector1 vector2 vector3</span>
<span class="co">#&gt; [1,]  0.1957  0.1957  0.1957</span>
<span class="co">#&gt; [2,]  0.4035  0.4035  0.4035</span>
<span class="co">#&gt; [3,]  0.0637  0.0637  0.0637</span>
<span class="kw">round</span>(my_matrix*<span class="dv">10</span>, <span class="dt">digits =</span> <span class="dv">2</span>) <span class="co"># 取2位</span>
<span class="co">#&gt;      vector1 vector2 vector3</span>
<span class="co">#&gt; [1,]    1.96    1.96    1.96</span>
<span class="co">#&gt; [2,]    4.04    4.04    4.04</span>
<span class="co">#&gt; [3,]    0.64    0.64    0.64</span></code></pre></div>
<p>取子集和计算</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">2</span>), <span class="dt">ncol =</span> <span class="dv">3</span>)
<span class="kw">print</span>(my_mat)
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,]    8    1    6</span>
<span class="co">#&gt; [2,]    3    5    7</span>
<span class="co">#&gt; [3,]    4    9    2</span>

my_mat[<span class="dv">1</span>,<span class="dv">1</span>] +<span class="st"> </span>my_mat[<span class="dv">1</span>, <span class="dv">2</span>] +<span class="st"> </span>my_mat[<span class="dv">1</span>,<span class="dv">3</span>]
<span class="co">#&gt; [1] 15</span>
<span class="kw">sum</span>(my_mat[<span class="dv">1</span>,])
<span class="co">#&gt; [1] 15</span>
<span class="kw">rowSums</span>(my_mat)
<span class="co">#&gt; [1] 15 15 15</span>
<span class="kw">colSums</span>(my_mat)
<span class="co">#&gt; [1] 15 15 15</span>
<span class="kw">sum</span>(<span class="kw">diag</span>(my_mat))
<span class="co">#&gt; [1] 15</span>

<span class="kw">class</span>(my_mat[<span class="dv">1</span>,]) <span class="co"># 退化成向量了</span>
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
my_mat[<span class="dv">1</span>, , drop=<span class="ot">FALSE</span>] <span class="co"># 保留矩阵属性</span>
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,]    8    1    6</span>
my_mat[my_mat &lt;=<span class="st"> </span><span class="dv">5</span>] &lt;-<span class="st"> </span><span class="dv">0</span> <span class="co"># 改变赋值</span>
my_mat
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,]    8    0    6</span>
<span class="co">#&gt; [2,]    0    0    7</span>
<span class="co">#&gt; [3,]    0    9    0</span>

<span class="co"># ifelse 函数</span>
my_mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">2</span>), <span class="dt">ncol =</span> <span class="dv">3</span>)
<span class="kw">ifelse</span>(my_mat &gt;<span class="st"> </span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,]    1    1    1</span>
<span class="co">#&gt; [2,]    1    1    1</span>
<span class="co">#&gt; [3,]    1    1    1</span></code></pre></div>
</div>
<div id="section-1.3" class="section level2">
<h2><span class="header-section-number">1.3</span> 数据框</h2>
<p>优点在于不同向量的数据类型可以不一样，但各列的长度必须一致</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">city &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;A&#39;</span>, <span class="st">&#39;B&#39;</span>, <span class="st">&#39;C&#39;</span>, <span class="st">&#39;D&#39;</span>)
temp &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">27</span>, <span class="dv">29</span>, <span class="dv">23</span>, <span class="dv">14</span>)
data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(city, temp) <span class="co"># 对于 list，Py 不能直接这么导，会把整数向量变为索引，得用 dir 的方式</span>
data
<span class="co">#&gt;   city temp</span>
<span class="co">#&gt; 1    A   27</span>
<span class="co">#&gt; 2    B   29</span>
<span class="co">#&gt; 3    C   23</span>
<span class="co">#&gt; 4    D   14</span>
data[, <span class="dv">1</span>] <span class="co"># Py data.ix[:,0] | data.iloc[:,0]</span>
<span class="co">#&gt; [1] A B C D</span>
<span class="co">#&gt; Levels: A B C D</span>
data$temp
<span class="co">#&gt; [1] 27 29 23 14</span>
<span class="kw">class</span>(data$city) <span class="co"># 本是字符，自动转了因子，若不想转，课用 stringAsFactors = FALSE 设定</span>
<span class="co">#&gt; [1] &quot;factor&quot;</span></code></pre></div>
<p>组合索引</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data[data$temp &gt;<span class="st"> </span><span class="kw">mean</span>(data$temp), ]
<span class="co">#&gt;   city temp</span>
<span class="co">#&gt; 1    A   27</span>
<span class="co">#&gt; 2    B   29</span>
<span class="co"># data[&#39;temp&#39;, ] # empty，这是提取行的语法</span>
data[, <span class="st">&#39;city&#39;</span>] <span class="co"># 提取列</span>
<span class="co">#&gt; [1] A B C D</span>
<span class="co">#&gt; Levels: A B C D</span>
data$temp &gt;<span class="st"> </span><span class="kw">mean</span>(data$temp)
<span class="co">#&gt; [1]  TRUE  TRUE FALSE FALSE</span>
<span class="kw">with</span>(data, data[temp &gt;<span class="st"> </span><span class="kw">mean</span>(temp), ]) <span class="co"># 直接操作列名,省略 $</span>
<span class="co">#&gt;   city temp</span>
<span class="co">#&gt; 1    A   27</span>
<span class="co">#&gt; 2    B   29</span>
<span class="kw">with</span>(data, data[temp &gt;<span class="st"> </span><span class="kw">mean</span>(temp), <span class="st">&#39;city&#39;</span>]) 
<span class="co">#&gt; [1] A B</span>
<span class="co">#&gt; Levels: A B C D</span></code></pre></div>
<p>熟悉数据框最快的办法</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(data) <span class="co"># as Py describe</span>
<span class="co">#&gt;  city       temp     </span>
<span class="co">#&gt;  A:1   Min.   :14.0  </span>
<span class="co">#&gt;  B:1   1st Qu.:20.8  </span>
<span class="co">#&gt;  C:1   Median :25.0  </span>
<span class="co">#&gt;  D:1   Mean   :23.2  </span>
<span class="co">#&gt;        3rd Qu.:27.5  </span>
<span class="co">#&gt;        Max.   :29.0</span>
<span class="kw">dim</span>(data) <span class="co"># as Py data.shape</span>
<span class="co">#&gt; [1] 4 2</span>
<span class="kw">head</span>(data) <span class="co"># 看前6行</span>
<span class="co">#&gt;   city temp</span>
<span class="co">#&gt; 1    A   27</span>
<span class="co">#&gt; 2    B   29</span>
<span class="co">#&gt; 3    C   23</span>
<span class="co">#&gt; 4    D   14</span>
<span class="co">#data.head(1) # 不能这么干</span>
<span class="kw">head</span>(data, <span class="dt">n =</span> 1L)
<span class="co">#&gt;   city temp</span>
<span class="co">#&gt; 1    A   27</span>
<span class="kw">str</span>(data) <span class="co"># 返回数据结构</span>
<span class="co">#&gt; &#39;data.frame&#39;:    4 obs. of  2 variables:</span>
<span class="co">#&gt;  $ city: Factor w/ 4 levels &quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;: 1 2 3 4</span>
<span class="co">#&gt;  $ temp: num  27 29 23 14</span></code></pre></div>
<p>数据框的排序</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">order</span>(data$temp) <span class="co"># 返回数据的索引号</span>
<span class="co">#&gt; [1] 4 3 1 2</span>
data[<span class="kw">order</span>(data$temp), ]
<span class="co">#&gt;   city temp</span>
<span class="co">#&gt; 4    D   14</span>
<span class="co">#&gt; 3    C   23</span>
<span class="co">#&gt; 1    A   27</span>
<span class="co">#&gt; 2    B   29</span>
data[<span class="kw">order</span>(data$temp, <span class="dt">decreasing =</span> T), ][<span class="dv">1</span>:<span class="dv">2</span>, ] <span class="co"># 反序</span>
<span class="co">#&gt;   city temp</span>
<span class="co">#&gt; 2    B   29</span>
<span class="co">#&gt; 1    A   27</span></code></pre></div>
</div>
<div id="section-1.4" class="section level2">
<h2><span class="header-section-number">1.4</span> 列表</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">temp =</span> temp, <span class="dt">city =</span> city)
<span class="kw">print</span>(data_list)
<span class="co">#&gt; $temp</span>
<span class="co">#&gt; [1] 27 29 23 14</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $city</span>
<span class="co">#&gt; [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot;</span>

data_list$mat &lt;-<span class="st"> </span>my_mat
data_list$data &lt;-<span class="st"> </span>data
<span class="kw">names</span>(data_list)
<span class="co">#&gt; [1] &quot;temp&quot; &quot;city&quot; &quot;mat&quot;  &quot;data&quot;</span>
<span class="kw">class</span>(data_list[<span class="dv">3</span>])
<span class="co">#&gt; [1] &quot;list&quot;</span>
data_list[<span class="dv">3</span>]
<span class="co">#&gt; $mat</span>
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,]    8    1    6</span>
<span class="co">#&gt; [2,]    3    5    7</span>
<span class="co">#&gt; [3,]    4    9    2</span>
data_list[[<span class="dv">3</span>]] <span class="co"># 没有 name</span>
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,]    8    1    6</span>
<span class="co">#&gt; [2,]    3    5    7</span>
<span class="co">#&gt; [3,]    4    9    2</span>
<span class="kw">class</span>(data_list[[<span class="dv">3</span>]])
<span class="co">#&gt; [1] &quot;matrix&quot;</span></code></pre></div>
</div>
<div id="section-1.5" class="section level2">
<h2><span class="header-section-number">1.5</span> 特殊对象</h2>
<p>缺失值和空值</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">temp &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">27</span>, <span class="dv">29</span>, <span class="dv">23</span>, <span class="dv">14</span>, <span class="ot">NA</span>)
<span class="kw">mean</span>(temp)
<span class="co">#&gt; [1] NA</span>
<span class="kw">mean</span>(temp, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1] 23.2</span>
temp &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">27</span>, <span class="dv">29</span>, <span class="dv">23</span>, <span class="dv">14</span>, <span class="ot">NULL</span>)
data_list &lt;-<span class="st"> </span><span class="ot">NULL</span> <span class="co"># 快速删除一列</span>
<span class="kw">mean</span>(temp) <span class="co"># TRUE</span>
<span class="co">#&gt; [1] 23.2</span></code></pre></div>
<p>连接</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">textcon =<span class="st"> </span><span class="kw">textConnection</span>(<span class="st">&#39;output&#39;</span>, <span class="st">&#39;w&#39;</span>)
<span class="kw">sink</span>(textcon) <span class="co"># 开</span>
x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">10</span>)
<span class="kw">summary</span>(x)
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   0.051   0.315   0.604   0.557   0.740   0.981</span>
<span class="kw">print</span>(<span class="st">&#39;这话不显示了，写入了 output 对象了&#39;</span>)
<span class="co">#&gt; [1] &quot;这话不显示了，写入了 output 对象了&quot;</span>
<span class="kw">sink</span>() <span class="co"># 关闭控制台转换</span>
<span class="kw">print</span>(output)
<span class="co">#&gt; character(0)</span>

<span class="kw">showConnections</span>()
<span class="co">#&gt;   description class            mode text   isopen   can read can write</span>
<span class="co">#&gt; 4 &quot;output&quot;    &quot;textConnection&quot; &quot;wr&quot; &quot;text&quot; &quot;opened&quot; &quot;no&quot;     &quot;yes&quot;    </span>
<span class="co">#&gt; 5 &quot;output&quot;    &quot;textConnection&quot; &quot;w&quot;  &quot;text&quot; &quot;opened&quot; &quot;no&quot;     &quot;yes&quot;</span>
<span class="kw">class</span>(textcon)
<span class="co">#&gt; [1] &quot;textConnection&quot; &quot;connection&quot;</span>
<span class="kw">close</span>(textcon)</code></pre></div>
<p>公式</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="dv">50</span>
xvar &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;x&#39;</span>, n )
right &lt;-<span class="st"> </span><span class="kw">paste</span>(xvar, <span class="dt">collapse =</span> <span class="st">&#39; + &#39;</span>)
left &lt;-<span class="st"> &#39;y~&#39;</span>
my_formula &lt;-<span class="st"> </span><span class="kw">paste</span>(left, right)
my_formula &lt;-<span class="st"> </span><span class="kw">as.formula</span>(my_formula)
<span class="kw">class</span>(my_formula)
<span class="co">#&gt; [1] &quot;formula&quot;</span>

left
<span class="co">#&gt; [1] &quot;y~&quot;</span></code></pre></div>
<p>表达式</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ex &lt;-<span class="st"> </span><span class="kw">expression</span>(x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">2</span>))
<span class="kw">print</span>(ex)
<span class="co">#&gt; expression(x &lt;- seq(1, 10, 2))</span>
<span class="kw">class</span>(ex)
<span class="co">#&gt; [1] &quot;expression&quot;</span>
<span class="kw">eval</span>(ex)
<span class="kw">print</span>(x)
<span class="co">#&gt; [1] 1 3 5 7 9</span>

tex &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;z&lt;-seq(1, 10, 2)&#39;</span>, <span class="st">&#39;print(z)&#39;</span> )
<span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> tex))
<span class="co">#&gt; [1] 1 3 5 7 9</span></code></pre></div>
<p>环境变量</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ls</span>()
<span class="co">#&gt;  [1] &quot;a&quot;           &quot;b&quot;           &quot;city&quot;        &quot;data&quot;        &quot;data_list&quot;  </span>
<span class="co">#&gt;  [6] &quot;ex&quot;          &quot;group1&quot;      &quot;group2&quot;      &quot;left&quot;        &quot;my_formula&quot; </span>
<span class="co">#&gt; [11] &quot;my_mat&quot;      &quot;my_matrix&quot;   &quot;n&quot;           &quot;output&quot;      &quot;right&quot;      </span>
<span class="co">#&gt; [16] &quot;temp&quot;        &quot;tex&quot;         &quot;textcon&quot;     &quot;vec&quot;         &quot;vec_random1&quot;</span>
<span class="co">#&gt; [21] &quot;vec_random2&quot; &quot;vector&quot;      &quot;vector1&quot;     &quot;vector2&quot;     &quot;vector3&quot;    </span>
<span class="co">#&gt; [26] &quot;x&quot;           &quot;xvar&quot;        &quot;z&quot;</span>
env1 &lt;-<span class="st"> </span><span class="kw">new.env</span>()

<span class="kw">assign</span>(<span class="st">&quot;x1&quot;</span>, <span class="dv">1</span>:<span class="dv">5</span>, <span class="dt">envir =</span> env1)
<span class="kw">ls</span>(<span class="dt">envir =</span> env1)
<span class="co">#&gt; [1] &quot;x1&quot;</span>
<span class="kw">get</span>(<span class="st">&#39;x1&#39;</span>, <span class="dt">envir =</span> env1) <span class="co"># 为啥没法直接用 x1 取呢？</span>
<span class="co">#&gt; [1] 1 2 3 4 5</span>

<span class="kw">exists</span>(<span class="st">&#39;x1&#39;</span>, <span class="dt">envir =</span> env1)
<span class="co">#&gt; [1] TRUE</span>
<span class="kw">rm</span>(<span class="st">&#39;x1&#39;</span>, <span class="dt">envir =</span> env1)</code></pre></div>
<p>函数</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">exp</span>(<span class="dv">1</span>)
<span class="co">#&gt; [1] 2.72</span>

myfunc &lt;-<span class="st"> </span>function(r){
  area &lt;-<span class="st"> </span>pi*r^<span class="dv">2</span>
  <span class="kw">return</span>(area)
} <span class="co"># 内部可以调用 global value</span>
<span class="kw">print</span>(<span class="kw">myfunc</span>(<span class="dv">4</span>)) 
<span class="co">#&gt; [1] 50.3</span>

myfunc
<span class="co">#&gt; function(r){</span>
<span class="co">#&gt;   area &lt;- pi*r^2</span>
<span class="co">#&gt;   return(area)</span>
<span class="co">#&gt; }</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="readr.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/scottming/rns",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
