<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Notes and Codes while Learning R</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="这里是明生学 R 的笔记。">
  <meta name="generator" content="bookdown 0.1 and GitBook 2.6.7">

  <meta property="og:title" content="Notes and Codes while Learning R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://bookdown.org/scottming/rns/" />
  
  <meta property="og:description" content="这里是明生学 R 的笔记。" />
  <meta name="github-repo" content="scottming/rns" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Notes and Codes while Learning R" />
  
  <meta name="twitter:description" content="这里是明生学 R 的笔记。" />
  

<meta name="author" content="Scott Ming">

<meta name="date" content="2016-07-30">


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="dplyr.html">


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="r4ds.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Notes and Codes while Learning R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="part"><span><b>Base</b></span></li>
<li class="chapter" data-level="1" data-path="r-.html"><a href="r-.html"><i class="fa fa-check"></i><b>1</b> R 数据结构</a><ul>
<li class="chapter" data-level="1.1" data-path="r-.html"><a href="r-.html#section-1.1"><i class="fa fa-check"></i><b>1.1</b> 向量</a></li>
<li class="chapter" data-level="1.2" data-path="r-.html"><a href="r-.html#section-1.2"><i class="fa fa-check"></i><b>1.2</b> 矩阵</a></li>
<li class="chapter" data-level="1.3" data-path="r-.html"><a href="r-.html#section-1.3"><i class="fa fa-check"></i><b>1.3</b> 数据框</a></li>
<li class="chapter" data-level="1.4" data-path="r-.html"><a href="r-.html#section-1.4"><i class="fa fa-check"></i><b>1.4</b> 列表</a></li>
<li class="chapter" data-level="1.5" data-path="r-.html"><a href="r-.html#section-1.5"><i class="fa fa-check"></i><b>1.5</b> 特殊对象</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="readr.html"><a href="readr.html"><i class="fa fa-check"></i><b>2</b> 数据读取（readr）</a><ul>
<li class="chapter" data-level="2.1" data-path="readr.html"><a href="readr.html#-read.table"><i class="fa fa-check"></i><b>2.1</b> 读取 read.table</a></li>
<li class="chapter" data-level="2.2" data-path="readr.html"><a href="readr.html#-readr"><i class="fa fa-check"></i><b>2.2</b> 高阶包 readr</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="apply.html"><a href="apply.html"><i class="fa fa-check"></i><b>3</b> 向量化操作（apply）</a><ul>
<li class="chapter" data-level="3.1" data-path="apply.html"><a href="apply.html#-lapplysapply"><i class="fa fa-check"></i><b>3.1</b> 循环迭代之 lapply/sapply</a></li>
<li class="chapter" data-level="3.2" data-path="apply.html"><a href="apply.html#section-3.2"><i class="fa fa-check"></i><b>3.2</b> 分组运算</a></li>
<li class="chapter" data-level="3.3" data-path="apply.html"><a href="apply.html#section-3.3"><i class="fa fa-check"></i><b>3.3</b> 多参数运算</a></li>
</ul></li>
<li class="part"><span><b>Explore</b></span></li>
<li class="chapter" data-level="4" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>4</b> 数据预处理（dplyr）</a><ul>
<li class="chapter" data-level="4.1" data-path="dplyr.html"><a href="dplyr.html#section-4.1"><i class="fa fa-check"></i><b>4.1</b> 导入数据</a></li>
<li class="chapter" data-level="4.2" data-path="dplyr.html"><a href="dplyr.html#-filter"><i class="fa fa-check"></i><b>4.2</b> 数据筛选 filter，返回满足条件的观测值</a></li>
<li class="chapter" data-level="4.3" data-path="dplyr.html"><a href="dplyr.html#-select"><i class="fa fa-check"></i><b>4.3</b> 子集选取 select，只保留选择的变量</a></li>
<li class="chapter" data-level="4.4" data-path="dplyr.html"><a href="dplyr.html#-arrange"><i class="fa fa-check"></i><b>4.4</b> 数据排序 arrange</a></li>
<li class="chapter" data-level="4.5" data-path="dplyr.html"><a href="dplyr.html#-mutate"><i class="fa fa-check"></i><b>4.5</b> 数据扩展 mutate</a></li>
<li class="chapter" data-level="4.6" data-path="dplyr.html"><a href="dplyr.html#-summarise"><i class="fa fa-check"></i><b>4.6</b> 数据汇总 summarise</a></li>
<li class="chapter" data-level="4.7" data-path="dplyr.html"><a href="dplyr.html#-join"><i class="fa fa-check"></i><b>4.7</b> 数据连接 join</a></li>
<li class="chapter" data-level="4.8" data-path="dplyr.html"><a href="dplyr.html#-group_by"><i class="fa fa-check"></i><b>4.8</b> 分组汇总 group_by</a></li>
</ul></li>
<li class="part"><span><b>Wrangles</b></span></li>
<li class="chapter" data-level="5" data-path="reshapetidy.html"><a href="reshapetidy.html"><i class="fa fa-check"></i><b>5</b> 数据整理、转换（reshape、tidy）</a><ul>
<li class="chapter" data-level="5.1" data-path="reshapetidy.html"><a href="reshapetidy.html#reshape2"><i class="fa fa-check"></i><b>5.1</b> reshape2</a><ul>
<li class="chapter" data-level="5.1.1" data-path="reshapetidy.html"><a href="reshapetidy.html#melt-"><i class="fa fa-check"></i><b>5.1.1</b> melt 熔化转长格式</a></li>
<li class="chapter" data-level="5.1.2" data-path="reshapetidy.html"><a href="reshapetidy.html#dcast-"><i class="fa fa-check"></i><b>5.1.2</b> dcast 重铸，长转宽</a></li>
<li class="chapter" data-level="5.1.3" data-path="reshapetidy.html"><a href="reshapetidy.html#fun"><i class="fa fa-check"></i><b>5.1.3</b> fun,加上集合函数就能按正确方式集合了。</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="reshapetidy.html"><a href="reshapetidy.html#tidyr"><i class="fa fa-check"></i><b>5.2</b> tidyr</a><ul>
<li class="chapter" data-level="5.2.1" data-path="reshapetidy.html"><a href="reshapetidy.html#gather-"><i class="fa fa-check"></i><b>5.2.1</b> gather 聚合</a></li>
<li class="chapter" data-level="5.2.2" data-path="reshapetidy.html"><a href="reshapetidy.html#spread-"><i class="fa fa-check"></i><b>5.2.2</b> spread 铺开</a></li>
<li class="chapter" data-level="5.2.3" data-path="reshapetidy.html"><a href="reshapetidy.html#unite-"><i class="fa fa-check"></i><b>5.2.3</b> unite 合并</a></li>
<li class="chapter" data-level="5.2.4" data-path="reshapetidy.html"><a href="reshapetidy.html#separate-"><i class="fa fa-check"></i><b>5.2.4</b> separate 拆分</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Notes and Codes while Learning R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reshapetidy" class="section level1">
<h1><span class="header-section-number">5</span> 数据整理、转换（reshape、tidy）</h1>
<div id="reshape2" class="section level2">
<h2><span class="header-section-number">5.1</span> reshape2</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(reshape2)
subdata &lt;-iris[,<span class="dv">4</span>:<span class="dv">5</span>]
<span class="kw">head</span>(subdata)
<span class="co">#&gt;   Petal.Width Species</span>
<span class="co">#&gt; 1         0.2  setosa</span>
<span class="co">#&gt; 2         0.2  setosa</span>
<span class="co">#&gt; 3         0.2  setosa</span>
<span class="co">#&gt; 4         0.2  setosa</span>
<span class="co">#&gt; 5         0.2  setosa</span>
<span class="co">#&gt; 6         0.4  setosa</span>
data_w &lt;-<span class="st"> </span><span class="kw">unstack</span>(subdata)
<span class="kw">colMeans</span>(data_w)
<span class="co">#&gt;     setosa versicolor  virginica </span>
<span class="co">#&gt;      0.246      1.326      2.026</span></code></pre></div>
<p>实践中这种单纯的长宽格式并不多见，更常见的是直接一步得到结果，所以就需要强大的 reshape2 包</p>
<p>参考<a href="http://seananderson.ca/2013/10/19/reshape.html">An Introduction to reshape2</a></p>
<p>加载包和改数据名</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(reshape2)
<span class="kw">names</span>(airquality) &lt;-<span class="st"> </span><span class="kw">tolower</span>(<span class="kw">names</span>(airquality))
<span class="kw">head</span>(airquality)
<span class="co">#&gt;   ozone solar.r wind temp month day</span>
<span class="co">#&gt; 1    41     190  7.4   67     5   1</span>
<span class="co">#&gt; 2    36     118  8.0   72     5   2</span>
<span class="co">#&gt; 3    12     149 12.6   74     5   3</span>
<span class="co">#&gt; 4    18     313 11.5   62     5   4</span>
<span class="co">#&gt; 5    NA      NA 14.3   56     5   5</span>
<span class="co">#&gt; 6    28      NA 14.9   66     5   6</span></code></pre></div>
<div id="melt-" class="section level3">
<h3><span class="header-section-number">5.1.1</span> melt 熔化转长格式</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">aql &lt;-<span class="st"> </span><span class="kw">melt</span>(airquality)
<span class="co">#&gt; No id variables; using all as measure variables</span>
<span class="kw">tail</span>(aql)
<span class="co">#&gt;     variable value</span>
<span class="co">#&gt; 913      day    25</span>
<span class="co">#&gt; 914      day    26</span>
<span class="co">#&gt; 915      day    27</span>
<span class="co">#&gt; 916      day    28</span>
<span class="co">#&gt; 917      day    29</span>
<span class="co">#&gt; 918      day    30</span>
<span class="kw">head</span>(aql)
<span class="co">#&gt;   variable value</span>
<span class="co">#&gt; 1    ozone    41</span>
<span class="co">#&gt; 2    ozone    36</span>
<span class="co">#&gt; 3    ozone    12</span>
<span class="co">#&gt; 4    ozone    18</span>
<span class="co">#&gt; 5    ozone    NA</span>
<span class="co">#&gt; 6    ozone    28</span></code></pre></div>
<p>设定不需要变 value 的变量</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">aql &lt;-<span class="st"> </span><span class="kw">melt</span>(airquality,<span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&#39;month&#39;</span>, <span class="st">&#39;day&#39;</span>))
<span class="kw">names</span>(airquality)
<span class="co">#&gt; [1] &quot;ozone&quot;   &quot;solar.r&quot; &quot;wind&quot;    &quot;temp&quot;    &quot;month&quot;   &quot;day&quot;</span>
<span class="kw">head</span>(aql)
<span class="co">#&gt;   month day variable value</span>
<span class="co">#&gt; 1     5   1    ozone    41</span>
<span class="co">#&gt; 2     5   2    ozone    36</span>
<span class="co">#&gt; 3     5   3    ozone    12</span>
<span class="co">#&gt; 4     5   4    ozone    18</span>
<span class="co">#&gt; 5     5   5    ozone    NA</span>
<span class="co">#&gt; 6     5   6    ozone    28</span></code></pre></div>
<p>改名</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">aql &lt;-<span class="st"> </span><span class="kw">melt</span>(airquality, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>),
            <span class="dt">variable.name =</span> <span class="st">&quot;climate_variable&quot;</span>,
            <span class="dt">value.name =</span> <span class="st">&quot;climate_value&quot;</span>)
<span class="kw">head</span>(aql)
<span class="co">#&gt;   month day climate_variable climate_value</span>
<span class="co">#&gt; 1     5   1            ozone            41</span>
<span class="co">#&gt; 2     5   2            ozone            36</span>
<span class="co">#&gt; 3     5   3            ozone            12</span>
<span class="co">#&gt; 4     5   4            ozone            18</span>
<span class="co">#&gt; 5     5   5            ozone            NA</span>
<span class="co">#&gt; 6     5   6            ozone            28</span>
<span class="kw">head</span>(airquality)
<span class="co">#&gt;   ozone solar.r wind temp month day</span>
<span class="co">#&gt; 1    41     190  7.4   67     5   1</span>
<span class="co">#&gt; 2    36     118  8.0   72     5   2</span>
<span class="co">#&gt; 3    12     149 12.6   74     5   3</span>
<span class="co">#&gt; 4    18     313 11.5   62     5   4</span>
<span class="co">#&gt; 5    NA      NA 14.3   56     5   5</span>
<span class="co">#&gt; 6    28      NA 14.9   66     5   6</span></code></pre></div>
</div>
<div id="dcast-" class="section level3">
<h3><span class="header-section-number">5.1.2</span> dcast 重铸，长转宽</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">aql &lt;-<span class="st"> </span><span class="kw">melt</span>(airquality, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>))
aqw  &lt;-<span class="st"> </span><span class="kw">dcast</span>(aql, month +<span class="st"> </span>day ~<span class="st"> </span>variable)
<span class="kw">head</span>(aql)
<span class="co">#&gt;   month day variable value</span>
<span class="co">#&gt; 1     5   1    ozone    41</span>
<span class="co">#&gt; 2     5   2    ozone    36</span>
<span class="co">#&gt; 3     5   3    ozone    12</span>
<span class="co">#&gt; 4     5   4    ozone    18</span>
<span class="co">#&gt; 5     5   5    ozone    NA</span>
<span class="co">#&gt; 6     5   6    ozone    28</span>
<span class="kw">head</span>(aqw)
<span class="co">#&gt;   month day ozone solar.r wind temp</span>
<span class="co">#&gt; 1     5   1    41     190  7.4   67</span>
<span class="co">#&gt; 2     5   2    36     118  8.0   72</span>
<span class="co">#&gt; 3     5   3    12     149 12.6   74</span>
<span class="co">#&gt; 4     5   4    18     313 11.5   62</span>
<span class="co">#&gt; 5     5   5    NA      NA 14.3   56</span>
<span class="co">#&gt; 6     5   6    28      NA 14.9   66</span></code></pre></div>
<p>不足的id.var 会出错，会把值的数量统计出来</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dcast</span>(aql, month ~<span class="st"> </span>variable)
<span class="co">#&gt; Aggregation function missing: defaulting to length</span>
<span class="co">#&gt;   month ozone solar.r wind temp</span>
<span class="co">#&gt; 1     5    31      31   31   31</span>
<span class="co">#&gt; 2     6    30      30   30   30</span>
<span class="co">#&gt; 3     7    31      31   31   31</span>
<span class="co">#&gt; 4     8    31      31   31   31</span>
<span class="co">#&gt; 5     9    30      30   30   30</span></code></pre></div>
</div>
<div id="fun" class="section level3">
<h3><span class="header-section-number">5.1.3</span> fun,加上集合函数就能按正确方式集合了。</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dcast</span>(aql, month ~<span class="st"> </span>variable, <span class="dt">fun.aggregate =</span> mean,
      <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt;   month ozone solar.r  wind temp</span>
<span class="co">#&gt; 1     5  23.6     181 11.62 65.5</span>
<span class="co">#&gt; 2     6  29.4     190 10.27 79.1</span>
<span class="co">#&gt; 3     7  59.1     216  8.94 83.9</span>
<span class="co">#&gt; 4     8  60.0     172  8.79 84.0</span>
<span class="co">#&gt; 5     9  31.4     167 10.18 76.9</span></code></pre></div>
</div>
</div>
<div id="tidyr" class="section level2">
<h2><span class="header-section-number">5.2</span> tidyr</h2>
<p>新建一列数据</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars$car &lt;-<span class="st"> </span><span class="kw">rownames</span>(mtcars)
<span class="kw">colnames</span>(mtcars)
<span class="co">#&gt;  [1] &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;drat&quot; &quot;wt&quot;   &quot;qsec&quot; &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot;</span>
<span class="co">#&gt; [11] &quot;carb&quot; &quot;car&quot;</span>
mtcars &lt;-<span class="st"> </span>mtcars[, <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">1</span>:<span class="dv">11</span>)]
<span class="kw">head</span>(mtcars)
<span class="co">#&gt;                                 car  mpg cyl disp  hp drat   wt qsec vs am</span>
<span class="co">#&gt; Mazda RX4                 Mazda RX4 21.0   6  160 110 3.90 2.62 16.5  0  1</span>
<span class="co">#&gt; Mazda RX4 Wag         Mazda RX4 Wag 21.0   6  160 110 3.90 2.88 17.0  0  1</span>
<span class="co">#&gt; Datsun 710               Datsun 710 22.8   4  108  93 3.85 2.32 18.6  1  1</span>
<span class="co">#&gt; Hornet 4 Drive       Hornet 4 Drive 21.4   6  258 110 3.08 3.21 19.4  1  0</span>
<span class="co">#&gt; Hornet Sportabout Hornet Sportabout 18.7   8  360 175 3.15 3.44 17.0  0  0</span>
<span class="co">#&gt; Valiant                     Valiant 18.1   6  225 105 2.76 3.46 20.2  1  0</span>
<span class="co">#&gt;                   gear carb</span>
<span class="co">#&gt; Mazda RX4            4    4</span>
<span class="co">#&gt; Mazda RX4 Wag        4    4</span>
<span class="co">#&gt; Datsun 710           4    1</span>
<span class="co">#&gt; Hornet 4 Drive       3    1</span>
<span class="co">#&gt; Hornet Sportabout    3    2</span>
<span class="co">#&gt; Valiant              3    1</span></code></pre></div>
<div id="gather-" class="section level3">
<h3><span class="header-section-number">5.2.1</span> gather 聚合</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyr)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: &#39;tidyr&#39;</span>
<span class="co">#&gt; The following object is masked from &#39;package:reshape2&#39;:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     smiths</span>
mtcarsNew &lt;-<span class="st"> </span>mtcars %&gt;%
<span class="st">  </span><span class="kw">gather</span>(attribute, value, -car) <span class="co">#不仅聚合，且命名了。</span>
<span class="kw">head</span>(mtcarsNew)
<span class="co">#&gt;                 car attribute value</span>
<span class="co">#&gt; 1         Mazda RX4       mpg  21.0</span>
<span class="co">#&gt; 2     Mazda RX4 Wag       mpg  21.0</span>
<span class="co">#&gt; 3        Datsun 710       mpg  22.8</span>
<span class="co">#&gt; 4    Hornet 4 Drive       mpg  21.4</span>
<span class="co">#&gt; 5 Hornet Sportabout       mpg  18.7</span>
<span class="co">#&gt; 6           Valiant       mpg  18.1</span>
<span class="kw">tail</span>(mtcarsNew)
<span class="co">#&gt;                car attribute value</span>
<span class="co">#&gt; 347  Porsche 914-2      carb     2</span>
<span class="co">#&gt; 348   Lotus Europa      carb     2</span>
<span class="co">#&gt; 349 Ford Pantera L      carb     4</span>
<span class="co">#&gt; 350   Ferrari Dino      carb     6</span>
<span class="co">#&gt; 351  Maserati Bora      carb     8</span>
<span class="co">#&gt; 352     Volvo 142E      carb     2</span></code></pre></div>
<p>gather mpg:gear 之间的列</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcarsNew &lt;-<span class="st"> </span>mtcars %&gt;%
<span class="st">  </span><span class="kw">gather</span>(attribute, value, mpg:gear)</code></pre></div>
</div>
<div id="spread-" class="section level3">
<h3><span class="header-section-number">5.2.2</span> spread 铺开</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcarsWide &lt;-<span class="st"> </span>mtcarsNew %&gt;%
<span class="st">  </span><span class="kw">spread</span>(attribute, value)
<span class="kw">head</span>(mtcarsWide)
<span class="co">#&gt;                  car carb am cyl disp drat gear  hp  mpg qsec vs   wt</span>
<span class="co">#&gt; 1        AMC Javelin    2  0   8  304 3.15    3 150 15.2 17.3  0 3.44</span>
<span class="co">#&gt; 2 Cadillac Fleetwood    4  0   8  472 2.93    3 205 10.4 18.0  0 5.25</span>
<span class="co">#&gt; 3         Camaro Z28    4  0   8  350 3.73    3 245 13.3 15.4  0 3.84</span>
<span class="co">#&gt; 4  Chrysler Imperial    4  0   8  440 3.23    3 230 14.7 17.4  0 5.34</span>
<span class="co">#&gt; 5         Datsun 710    1  1   4  108 3.85    4  93 22.8 18.6  1 2.32</span>
<span class="co">#&gt; 6   Dodge Challenger    2  0   8  318 2.76    3 150 15.5 16.9  0 3.52</span></code></pre></div>
</div>
<div id="unite-" class="section level3">
<h3><span class="header-section-number">5.2.3</span> unite 合并</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
date &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&#39;2016-06-01&#39;</span>) +<span class="st"> </span><span class="dv">0</span>:<span class="dv">14</span>

hour &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span>:<span class="dv">24</span>, <span class="dv">15</span>)
min &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span>:<span class="dv">60</span>, <span class="dv">15</span>)
second &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span>:<span class="dv">60</span>, <span class="dv">15</span>)
event &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dv">15</span>)
df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(date, hour, min, second, event)
<span class="kw">head</span>(df)
<span class="co">#&gt;         date hour min second event</span>
<span class="co">#&gt; 1 2016-06-01    7  30     29     u</span>
<span class="co">#&gt; 2 2016-06-02    9  43     36     a</span>
<span class="co">#&gt; 3 2016-06-03   13  58     60     l</span>
<span class="co">#&gt; 4 2016-06-04   20  22     11     q</span>
<span class="co">#&gt; 5 2016-06-05    5  44     47     p</span>
<span class="co">#&gt; 6 2016-06-06   18  52     37     k</span>

df1 &lt;-<span class="st"> </span>df %&gt;%
<span class="st">  </span><span class="kw">unite</span>(datehour, date, hour, <span class="dt">sep =</span> <span class="st">&#39; &#39;</span>) %&gt;%
<span class="st">  </span><span class="kw">unite</span>(datetime, datehour, min, second, <span class="dt">sep =</span> <span class="st">&#39;:&#39;</span>)
df1
<span class="co">#&gt;               datetime event</span>
<span class="co">#&gt; 1   2016-06-01 7:30:29     u</span>
<span class="co">#&gt; 2   2016-06-02 9:43:36     a</span>
<span class="co">#&gt; 3  2016-06-03 13:58:60     l</span>
<span class="co">#&gt; 4  2016-06-04 20:22:11     q</span>
<span class="co">#&gt; 5   2016-06-05 5:44:47     p</span>
<span class="co">#&gt; 6  2016-06-06 18:52:37     k</span>
<span class="co">#&gt; 7  2016-06-07 19:12:43     r</span>
<span class="co">#&gt; 8   2016-06-08 12:35:6     i</span>
<span class="co">#&gt; 9   2016-06-09 11:7:38     e</span>
<span class="co">#&gt; 10  2016-06-10 1:14:21     b</span>
<span class="co">#&gt; 11  2016-06-11 3:20:42     w</span>
<span class="co">#&gt; 12  2016-06-12 14:1:32     t</span>
<span class="co">#&gt; 13 2016-06-13 23:19:52     h</span>
<span class="co">#&gt; 14 2016-06-14 21:41:26     s</span>
<span class="co">#&gt; 15  2016-06-15 8:16:25     o</span></code></pre></div>
</div>
<div id="separate-" class="section level3">
<h3><span class="header-section-number">5.2.4</span> separate 拆分</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df2 &lt;-<span class="st"> </span>df1 %&gt;%
<span class="st">  </span><span class="kw">separate</span>(datetime, <span class="kw">c</span>(<span class="st">&#39;date&#39;</span>, <span class="st">&#39;time&#39;</span>), <span class="dt">sep =</span> <span class="st">&#39; &#39;</span>) %&gt;%
<span class="st">  </span><span class="kw">separate</span>(time, <span class="kw">c</span>(<span class="st">&#39;hour&#39;</span>, <span class="st">&#39;min&#39;</span>, <span class="st">&#39;second&#39;</span>), <span class="dt">sep =</span> <span class="st">&#39;:&#39;</span>)
df2
<span class="co">#&gt;          date hour min second event</span>
<span class="co">#&gt; 1  2016-06-01    7  30     29     u</span>
<span class="co">#&gt; 2  2016-06-02    9  43     36     a</span>
<span class="co">#&gt; 3  2016-06-03   13  58     60     l</span>
<span class="co">#&gt; 4  2016-06-04   20  22     11     q</span>
<span class="co">#&gt; 5  2016-06-05    5  44     47     p</span>
<span class="co">#&gt; 6  2016-06-06   18  52     37     k</span>
<span class="co">#&gt; 7  2016-06-07   19  12     43     r</span>
<span class="co">#&gt; 8  2016-06-08   12  35      6     i</span>
<span class="co">#&gt; 9  2016-06-09   11   7     38     e</span>
<span class="co">#&gt; 10 2016-06-10    1  14     21     b</span>
<span class="co">#&gt; 11 2016-06-11    3  20     42     w</span>
<span class="co">#&gt; 12 2016-06-12   14   1     32     t</span>
<span class="co">#&gt; 13 2016-06-13   23  19     52     h</span>
<span class="co">#&gt; 14 2016-06-14   21  41     26     s</span>
<span class="co">#&gt; 15 2016-06-15    8  16     25     o</span></code></pre></div>
<p>总的来说，tidyr 包比reshape语法更为简洁易懂， 更加方便。</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dplyr.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>


<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/scottming/rns",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
